<html>
<body>
<p>Run tests in your browser! If you can think of a better way how to achieve same and/or turn it into a unit test,
please let us know or raise a PR!</p>

<p>
    Things tried:
        <ul>
            <li>Rhino and Nashorn - both don't support ES2018 (required for RegExp named groups capturing)</li>
        </ul>
</p>


<p>
    Please open the DevTools console to see the execution log.
</p>

<hr />
<script type="text/javascript" src="config.js"></script>

<div id="errorDiv"></div>
<div id="successDiv"></div>
<input id="textRegexInput" type="text" value="" />

<script>

function isErrorVisible() {
    return document.getElementById('errorDiv').style.display == 'block';
}

function isSuccessVisible() {
    return document.getElementById('successDiv').style.display == 'block';
}

function setTestRegex(regexStr) {
    document.getElementById('textRegexInput').value = regexStr;
}

function getErrorMessage() {
    return document.getElementById('errorDiv').innerHTML;
}

function getSuccessMessage() {
    return document.getElementById('successDiv').innerHTML;
}

function assertTrue(bool) {
    if (!bool) {
        throw new Error("Assertion error");
    } else {
        console.log("check!");
    }
}

{
    console.warn("Test browser not supported case");
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");
    testObj._isCapturingGroupsSupported = function() { return false; };

    assertTrue(!testObj.test("blah", ["a"]));
    assertTrue(isErrorVisible());
    assertTrue(!isSuccessVisible());
    assertTrue(getErrorMessage().indexOf("Your browser does not support") >= 0);
}

{
    console.warn("Happy path no groups");
    setTestRegex("^Hello .*$")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");
    testObj._getUserInput = function(question) {
        assertTrue(question === "TheQuestion");
        return "Hello World";
    }

    assertTrue(!testObj.test("TheQuestion", []));
    assertTrue(!isErrorVisible());
    assertTrue(isSuccessVisible());
    assertTrue(getSuccessMessage() === "Matches!");
}

{
    console.warn("Happy path no groups");
    setTestRegex("^Hello .*$")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");
    testObj._getUserInput = function(question) {
        assertTrue(question === "TheQuestion");
        return "Hello World";
    }

    assertTrue(!testObj.test("TheQuestion", []));
    assertTrue(!isErrorVisible());
    assertTrue(isSuccessVisible());
    assertTrue(getSuccessMessage() === "Matches!");
}

{
    console.warn("Invalid regex");
    setTestRegex("^Hello (?<")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");

    assertTrue(!testObj.test("TheQuestion", []));
    assertTrue(isErrorVisible());
    assertTrue(!isSuccessVisible());
    assertTrue(getErrorMessage() === '"^Hello (?&lt;" is not a valid RegEx string. SyntaxError: Invalid regular expression: /^Hello (?&lt;/: Invalid capture group name');
}

{
    console.warn("Empty regex");
    setTestRegex("")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");

    assertTrue(!testObj.test("TheQuestion", []));
    assertTrue(isErrorVisible());
    assertTrue(!isSuccessVisible());
    assertTrue(getErrorMessage() === 'Empty RegEx, nothing to test');
}

{
    console.warn("Happy path with groups");
    setTestRegex("^Hello (?<group1>.*) (?<group2>.*)$")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");
    testObj._getUserInput = function(question) {
        assertTrue(question === "TheQuestion");
        return "Hello WorldFirst WorldSecond";
    }

    assertTrue(!testObj.test("TheQuestion", ["group1", "group2"]));
    assertTrue(!isErrorVisible());
    assertTrue(isSuccessVisible());
    assertTrue(getSuccessMessage() === "Matches: group1=WorldFirst, group2=WorldSecond");
}

{
    console.warn("Happy path not all groups");
    setTestRegex("^Hello (?<group1>.*) (?<group2>.*)$")
    const testObj = new AtlassianRegexTester("textRegexInput", "errorDiv", "successDiv");
    testObj._getUserInput = function(question) {
        assertTrue(question === "TheQuestion");
        return "Hello WorldFirst ";
    }

    assertTrue(!testObj.test("TheQuestion", ["group1", "group2"]));
    assertTrue(!isErrorVisible());
    assertTrue(isSuccessVisible());
    assertTrue(getSuccessMessage() === "Matches: group1=WorldFirst, group2=");
}

console.warn("All checks are passing!")

</script>

</body>
</html>